external_components:
  - source:
      type: git
      url: https://github.com/muxa/esphome-state-machine

state_machine:
  - name: Fan Mode
    initial_state: "BOOTING"
    id: state_machine_mode
    states:
      - name: NORMAL
        on_set:
          - logger.log: "Normal State"
          - light.turn_on:
              id: fastled_light
              red: 0%
              green: 100%
              blue: 0%
              brightness: 1.0
              effect: None
        on_enter:
          - logger.log: "Normal State"
          - light.turn_on:
              id: fastled_light
              red: 0%
              green: 100%
              blue: 0%
              brightness: 1.0
              effect: None
      - name: SILENCED
        on_enter:
          - logger.log: "Silenced State"
          - light.turn_on:
              id: fastled_light
              red: 0%
              green: 0%
              blue: 100%
              brightness: 1.0
              effect: None
      - name: ERROR
        on_enter:
          - logger.log: "Temperature too high/low"
          - light.turn_on:
              id: fastled_light
              effect: Flashing Red
          # TODO: set fans to 100%
          # TODO: Change from flashing red to a unique pattern
      - name: TURBO
        on_enter:
          - logger.log: "Fan is in turbo mode"
          - light.turn_on:
              id: fastled_light
              effect: Breathing Effect
      - name: PARTY
        on_enter:
          - logger.log: "Fan is in party mode"
          - light.turn_on:
              id: fastled_light
              red: 0%
              green: 50%
              blue: 100%
              effect: Scanning color"
      - name: BOOTING
        on_set:
          - logger.log: "Fan is booting"
          - light.turn_off:
              id: fastled_light
          - light.turn_on:
              id: fastled_light
              effect: Rainbow Effect
    inputs:
      - name: "TOGGLE"
        transitions:
          - NORMAL -> SILENCED
          - SILENCED -> NORMAL
      - name: "ERROR"
        transitions:
          - NORMAL -> ERROR
          - SILENCED -> ERROR
          - TURBO -> ERROR
          - PARTY -> ERROR
          - ERROR -> NORMAL
          - ERROR -> SILENCED
          - ERROR -> TURBO
          - ERROR -> PARTY


text_sensor:
  - platform: state_machine
    name: Cooling Mode
    id: state_machine_text

# interval:
#   - interval: 5s
#     then:
      # - lambda: |-
      #     if (id(state_machine_text).state == "NORMAL") {
      #       id(fastled_light).turn_on(
      #         red=255,
      #         green=0,
      #         blue=0,
      #         brightness=1.0
      #       );
      #     }
